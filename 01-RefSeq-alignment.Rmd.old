# Optimising analysis

```{r include=FALSE}

knitr::opts_chunk$set(echo = TRUE, cache = FALSE)

```

```{r include=FALSE}

# Load data
source("./scripts/0_meta_env_prep.R")
source("./scripts/0_get_RefSeq_excluded.R")

fit_contrasts_refseq <- readRDS("./output/data_expression/post_DGE/fit_contrasts_refseq.RDS")
fit_contrasts_ensembl <- readRDS("./output/data_expression/post_DGE/fit_contrasts.RDS")

```

## Introduction

The Ion Torrent AmpliSeq Human Gene Expression Kit amplifies 20,802 human genes via multiplex PCR and quantifies these genes via sequencing. Each gene is targeted using a single primer pair designed to generate a single \~100bp amplicon for each gene. The library containing these amplicons is then sequenced.

Standard RNA-seq sequence alignment involves aligning sequence reads against a "whole" transcriptome database such as ENSEMBL or GENCODE. However, for this targeted sequencing approach, aligning the sequence reads against only the targeted genes might produce more accurate results.

Popular RNA-seq analysis softwares include DESeq2, limma-voom, and edgeR. While all are considered to be robust, these methods all apply different statistical models and could have different statistical power.

## Methods

Transcripts from the latest version of RefSeq (GCF_000001405.39) was downloaded from NCBI Datasets via FTP (`https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/001/405/GCF_000001405.39_GRCh38.p13/`, file `GCF_000001405.39_GRCh38.p13_rna.fna.gz`). The Ion Torrent AmpliSeq Human Gene Expression Kit manifest was supplied by the manufacturer. `seqkit grep` was used to filter RefSeq for only transcripts present in manufacturer's manifest. `seqkit stats` and `seqkit faidx` was used to profile the generated list of transcripts. The `org.Hs.eg.db` annotation package was used to associate RefSeq IDs with other information related to the gene.

The filtered RefSeq transcripts were then used to construct a Salmon index for transcript quantification. This "RefSeq index" was compared to the "ENSEMBL index" prepared previously.

Some genes were not found in the RefSeq transcripts FTP download. These genes were collated and were spot-checked against NCBI to determine the cause of exclusion.

## Results

### Generation of RefSeq index

The manufacturer's manifest contained 20,802 genes. These genes encode for both coding (`NM_`) and non-coding RNA (`NR_`).

```{r}

ampliseq_manifest %>% reactable()

```

After filtering, there were 20,240 transcripts (representing 20,240 genes) in the RefSeq sequences. 562 genes were excluded - these genes were present in the AmpliSeq manifest but not present in the latest version of RefSeq.

```{r}

diff %>% reactable()

```

The records of these genes are suppressed in the current version of RefSeq, for example:

-   NM_152392: Removed due to being a pseudogene

-   NM_000034: Removed because the transcript represents a separate gene

-   NR_038267: Removed because the transcript encodes a protein-coding gene

Within these genes, 140 genes were not annotated by the `org.Hs.eg.db` package.

```{r}

diff %>% .[!complete.cases(.),] %>% reactable()

```

The RefSeq records of these genes suggest that they have been replaced by other RefSeq sequences, or there was insufficient data to support these transcripts.

### Comparison of t-tests results between ENSEMBL index and RefSeq index

#### Limma-voom

##### ENSEMBL index

```{r}
summary(decideTests(fit_contrasts_ensembl))

glimmaVolcano(fit_contrasts_ensembl, coef = 1)
```

##### RefSeq index

```{r}
summary(decideTests(fit_contrasts_refseq))

glimmaVolcano(fit_contrasts_refseq, coef = 1)
```

#### DESeq2

##### ENSEMBL index

##### RefSeq index

## Discussion

In the interest of time, the 562 genes found to be not present in the current versions of RefSeq were only spot checked. However, spot checking did reveal potential reasons for exclusion, including changes in the biotype of the gene (from non-coding to coding, and vice versa), evidence suggesting that it is a pseudogene, or transcripts that were insufficiently supported.

A number of these genes were found to have had their RefSeq IDs changed. In theory, these IDs can be updated to the latest version to include these genes in the dataset. However, NCBI does not seem to have a tool for automatically "lifting" these outdated IDs to the latest version. Any updating must be done manually.
