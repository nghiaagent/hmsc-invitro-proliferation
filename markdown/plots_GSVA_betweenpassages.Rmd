---
title: "Gene Set Variation Analysis - Between passages"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache = FALSE)
knitr::opts_chunk$set(dpi=300,fig.width=8, fig.height = 6)
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = TRUE
                      )

## Switch working directory to project dir

knitr::opts_knit$set(root.dir = '..')
```


```{r Load data, include=FALSE}
# Load packages

source("./scripts/0_meta_env_prep.R")

# Construct file paths

# Load data for D5 vs D3 GSVA

fit_GSVA <- readRDS("./output/data_enrichment/GSVA/GSVA_results.RDS")

quant_GSVA <- readRDS("./output/data_enrichment/GSVA/quant_GSVA.RDS")

conditions_interest <- c(
  "P5D3Untreated",
  "P7D3Untreated",
  "P13D3Untreated"
)

```


# Methods

Single sample gene set enrichment analysis using GSVA was used to quantify pathway activity within each sample. Statistical analysis using limma was then used to determine activity changes between hMSC growth phases.

The following databases were used:

-   GO

    -   Biological Processes

    -   Cellular Component

    -   Molecular Function

-   MSigDB

    -   h: Hallmark

    -   c2: Curated

    -   c3: Regulatory targets

-   ReactomePA

-   KEGG

# P7vsP5

## GO

### BP

```{r}

glimmaVolcano(
  x = fit_GSVA$GOBP,
  counts = quant_GSVA$GOBP[, quant_GSVA$GOBP@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$GOBP[, quant_GSVA$GOBP@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 13
)

```

### CC

```{r}

glimmaVolcano(
  x = fit_GSVA$GOCC,
  counts = quant_GSVA$GOCC[, quant_GSVA$GOCC@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$GOCC[, quant_GSVA$GOCC@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 13
)

```

### MF

```{r}

glimmaVolcano(
  x = fit_GSVA$GOMF,
  counts = quant_GSVA$GOMF[, quant_GSVA$GOMF@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$GOMF[, quant_GSVA$GOMF@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 13
)

```

## MSigDB

### h

```{r}

glimmaVolcano(
  x = fit_GSVA$h,
  counts = quant_GSVA$h[, quant_GSVA$h@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$h[, quant_GSVA$h@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 13
)

```

### c2

```{r}

glimmaVolcano(
  x = fit_GSVA$c2,
  counts = quant_GSVA$c2[, quant_GSVA$c2@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$c2[, quant_GSVA$c2@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 13
)

```

### c3

```{r}

glimmaVolcano(
  x = fit_GSVA$c3,
  counts = quant_GSVA$c3[, quant_GSVA$c3@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$c3[, quant_GSVA$c3@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 13
)

```

## Reactome

```{r}

glimmaVolcano(
  x = fit_GSVA$Reactome,
  counts = quant_GSVA$Reactome[, quant_GSVA$Reactome@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$Reactome[, quant_GSVA$Reactome@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 13
)

```

## KEGG

```{r}

glimmaVolcano(
  x = fit_GSVA$KEGG,
  counts = quant_GSVA$KEGG[, quant_GSVA$KEGG@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$KEGG[, quant_GSVA$KEGG@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 13
)

```

## GCN

```{r}

glimmaVolcano(
  x = fit_GSVA$GCN,
  counts = quant_GSVA$GCN[, quant_GSVA$GCN@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$GCN[, quant_GSVA$GCN@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 13
)

```


# P13vsP7

## GO

### BP

```{r}

glimmaVolcano(
  x = fit_GSVA$GOBP,
  counts = quant_GSVA$GOBP[, quant_GSVA$GOBP@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$GOBP[, quant_GSVA$GOBP@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 14
)

```

### CC

```{r}

glimmaVolcano(
  x = fit_GSVA$GOCC,
  counts = quant_GSVA$GOCC[, quant_GSVA$GOCC@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$GOCC[, quant_GSVA$GOCC@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 14
)

```

### MF

```{r}

glimmaVolcano(
  x = fit_GSVA$GOMF,
  counts = quant_GSVA$GOMF[, quant_GSVA$GOMF@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$GOMF[, quant_GSVA$GOMF@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 14
)

```

## MSigDB

### h

```{r}

glimmaVolcano(
  x = fit_GSVA$h,
  counts = quant_GSVA$h[, quant_GSVA$h@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$h[, quant_GSVA$h@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 14
)

```

### c2

```{r}

glimmaVolcano(
  x = fit_GSVA$c2,
  counts = quant_GSVA$c2[, quant_GSVA$c2@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$c2[, quant_GSVA$c2@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 14
)

```

### c3

```{r}

glimmaVolcano(
  x = fit_GSVA$c3,
  counts = quant_GSVA$c3[, quant_GSVA$c3@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$c3[, quant_GSVA$c3@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 14
)

```

## Reactome

```{r}

glimmaVolcano(
  x = fit_GSVA$Reactome,
  counts = quant_GSVA$Reactome[, quant_GSVA$Reactome@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$Reactome[, quant_GSVA$Reactome@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 14
)

```

## KEGG

```{r}

glimmaVolcano(
  x = fit_GSVA$KEGG,
  counts = quant_GSVA$KEGG[, quant_GSVA$KEGG@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$KEGG[, quant_GSVA$KEGG@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 14
)

```

## GCN

```{r}

glimmaVolcano(
  x = fit_GSVA$GCN,
  counts = quant_GSVA$GCN[, quant_GSVA$GCN@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$GCN[, quant_GSVA$GCN@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 14
)

```


# P13vsP5

## GO

### BP

```{r}

glimmaVolcano(
  x = fit_GSVA$GOBP,
  counts = quant_GSVA$GOBP[, quant_GSVA$GOBP@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$GOBP[, quant_GSVA$GOBP@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 15
)

```

### CC

```{r}

glimmaVolcano(
  x = fit_GSVA$GOCC,
  counts = quant_GSVA$GOCC[, quant_GSVA$GOCC@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$GOCC[, quant_GSVA$GOCC@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 15
)

```

### MF

```{r}

glimmaVolcano(
  x = fit_GSVA$GOMF,
  counts = quant_GSVA$GOMF[, quant_GSVA$GOMF@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$GOMF[, quant_GSVA$GOMF@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 15
)

```

## MSigDB

### h

```{r}

glimmaVolcano(
  x = fit_GSVA$h,
  counts = quant_GSVA$h[, quant_GSVA$h@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$h[, quant_GSVA$h@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 15
)

```

### c2

```{r}

glimmaVolcano(
  x = fit_GSVA$c2,
  counts = quant_GSVA$c2[, quant_GSVA$c2@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$c2[, quant_GSVA$c2@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 15
)

```

### c3

```{r}

glimmaVolcano(
  x = fit_GSVA$c3,
  counts = quant_GSVA$c3[, quant_GSVA$c3@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$c3[, quant_GSVA$c3@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 15
)

```

## Reactome

```{r}

glimmaVolcano(
  x = fit_GSVA$Reactome,
  counts = quant_GSVA$Reactome[, quant_GSVA$Reactome@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$Reactome[, quant_GSVA$Reactome@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 15
)

```

## KEGG

```{r}

glimmaVolcano(
  x = fit_GSVA$KEGG,
  counts = quant_GSVA$KEGG[, quant_GSVA$KEGG@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$KEGG[, quant_GSVA$KEGG@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 15
)

```

## GCN

```{r}

glimmaVolcano(
  x = fit_GSVA$GCN,
  counts = quant_GSVA$GCN[, quant_GSVA$GCN@phenoData@data$condition_ID %in% conditions_interest]@assayData[["exprs"]],
  groups = quant_GSVA$GCN[, quant_GSVA$GCN@phenoData@data$condition_ID %in% conditions_interest]@phenoData@data$condition_ID,
  xlab = "logFC",
  transform.counts = "none",
  coef = 15
)

```

